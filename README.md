# Introduction

This directory contains everthing to create an kubernetes cluster with Canonical multipass hypervisor.

## Prerequistes

Ensure that you have sudo right

You must also install

Linux Plateform
    multipass
    libvirt
    python
    python-yaml

Darwin Plateform
    multipass
    python
    python-yaml
    gnu-getopt

## Create the cluster

The simply way to create the cluster is to run [create-masterkube.sh](create-masterkube.sh). The default name of the cluster is kube

Some needed file are located in:

| Name | Description |
| --- | --- |
| `bin` | Essentials scripts to build the master kubernetes node  |
| `etc/ssl`  | Your CERT for https. Autosigned will be generated if empty  |
| `template`  | Templates files to deploy pod & service |

The first thing done by this script is to create a Ubuntu-18.04.2 image with kubernetes and docker installed. The image will be located here [~/.local/multipass/cache](file://~/.local/multipass/cache)

Next step will be to launch a multipass VM and create a master node. It will also deploy a dashboard at the URL https://master-kube-dashboard.@your-domain@/

To connect to the dashboard, copy paste the token from file [cluster/dashboard-token](./cluster/dashboard-token)

Next step is to deploy a replicaset helloworld as sample with an ingress controller and ingress rules.

During the process the script will create many files located in

| Name | Description |
| --- | --- |
| `cluster` | Essentials file to connect to kubernetes with kubeadm join  |
| `config`  | Configuration file generated during the build process  |
| `kubernetes`  | Files generated by kubeadm init located in /etc/kubernetes of master node |

## Command line arguments

| Parameter | Description | Default |
| --- | --- |--- |
| `-c` | Number of cpus per machine  | 4 |
| `-d` | Disk size per machine  | 10G |
| `-m` | Memory per machine  | 4G |
| `-n` | Cluster name  | kube |
| `--no-custom-image` | Use standard image  | NO |
| `--image`  | Alternate image  ||
| `--ssh-key`  |Alternate ssh key file | ~/.ssh/id_rsa |
| `--cni-version`  |CNI version | 0.75 |
| `--password`  |Define the kubernetes user password |randomized|
| `--kubernetes-version`  |Which version of kubernetes to use |latest|
| `--max-nodes-total` | Maximum number of worker nodes | 3 |

## Delete master kube and worker nodes

To delete the master kube and associated worker nodes, just run the command [delete-masterkube.sh](./bin/delete-masterkube.sh)
